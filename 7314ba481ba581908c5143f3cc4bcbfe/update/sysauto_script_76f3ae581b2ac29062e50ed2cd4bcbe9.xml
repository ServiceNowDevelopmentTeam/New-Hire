<?xml version="1.0" encoding="UTF-8"?><record_update table="sysauto_script">
    <sysauto_script action="INSERT_OR_UPDATE">
        <active>false</active>
        <business_calendar/>
        <condition><![CDATA[var now = new GlideDateTime();
var day = now.getDayOfWeekLocalTime();
var answer = !(day == 6 || day == 7);
answer;]]></condition>
        <conditional>true</conditional>
        <entered_time>1970-01-01 06:00:15</entered_time>
        <max_drift/>
        <name>Supervisor Reminder</name>
        <offset/>
        <offset_type>0</offset_type>
        <run_as display_value="James Benagh">037a34211b12c250c16ddb9ebd4bcb7f</run_as>
        <run_as_tz/>
        <run_dayofmonth>1</run_dayofmonth>
        <run_dayofweek>1</run_dayofweek>
        <run_period/>
        <run_start>2024-05-29 17:39:35</run_start>
        <run_time>1970-01-01 12:00:15</run_time>
        <run_type>daily</run_type>
        <script><![CDATA[(function() {
    //Get the relative duration for 5 business days
    var relDur = '3a8366581b2ac29062e50ed2cd4bcb09';
    //get the ritms related to supervisor to-do CI
    var encQue = 'active=true^cat_item=3680c97e1b520e5062e50ed2cd4bcbbc^opened_atNOTONToday@javascript:gs.beginningOfToday()@javascript:gs.endOfToday()';
    var gr = new GlideRecord('sc_req_item');
    gr.addEncodedQuery(encQue);
    gr.query();
    while (gr.next()) {
        //Calculate and see if resolve date is less than 6 business days ago. And if so, send reminder.
        var dc = new DurationCalculator();
        //Load the schedule into our calculation through the function below
        addSchedule(dc);
        //Do the calculation and see if end date is before today
        dc.setStartDateTime(gr.opened_at);
        if (!dc.calcRelativeDuration(relDur)) {
            gs.error("*** calcRelativeDuration failed for record {0}", gr.number);
        }
        if (dc.getEndDateTime() > gs.nowDateTime()) {
			//Fire event
			gs.eventQueue("supervisor_todo_reminder", gr, gr.variables.supervisor.sys_id, gr.opened_by.sys_id);
        }
		else {
			//close record, send closure notification
			gr.stage = "Request Cancelled";
			gr.state = "3";
			gr.update();
			gs.eventQueue("supervisor_todo_close", gr, gr.variables.supervisor.sys_id, gr.opened_by.sys_id);
		}
    }
    function addSchedule(durationCalculator) {
        var scheduleName = "6-6 Weekdays";
        var grSched = new GlideRecord('cmn_schedule');
        grSched.addQuery('name', scheduleName);
        grSched.query();
        if (!grSched.next()) {
            gs.error("*** Could not find schedule {0}.", scheduleName);
            return;
        }
        return durationCalculator.setSchedule(grSched.getUniqueValue(), "GMT");
    }
})();]]></script>
        <sys_class_name>sysauto_script</sys_class_name>
        <sys_created_by>james.benagh@glidefast.com</sys_created_by>
        <sys_created_on>2024-05-29 18:08:56</sys_created_on>
        <sys_id>76f3ae581b2ac29062e50ed2cd4bcbe9</sys_id>
        <sys_mod_count>11</sys_mod_count>
        <sys_name>Supervisor Reminder</sys_name>
        <sys_package display_value="Global" source="global">global</sys_package>
        <sys_policy/>
        <sys_scope display_value="New Hire">7314ba481ba581908c5143f3cc4bcbfe</sys_scope>
        <sys_update_name>sysauto_script_76f3ae581b2ac29062e50ed2cd4bcbe9</sys_update_name>
        <sys_updated_by>Terry.Lillo</sys_updated_by>
        <sys_updated_on>2024-10-10 20:58:11</sys_updated_on>
        <time_zone>Canada/Central</time_zone>
        <upgrade_safe>false</upgrade_safe>
    </sysauto_script>
    <sys_claim action="INSERT_OR_UPDATE">
        <claim_owner_scope display_value="New Hire">7314ba481ba581908c5143f3cc4bcbfe</claim_owner_scope>
        <claim_timestamp>19278398fe90000001</claim_timestamp>
        <metadata_update_name>sysauto_script_76f3ae581b2ac29062e50ed2cd4bcbe9</metadata_update_name>
        <previous_claim_app_version>3.0.3</previous_claim_app_version>
        <previous_claim_name>New Hire</previous_claim_name>
        <previous_claim_scope>7314ba481ba581908c5143f3cc4bcbfe</previous_claim_scope>
        <sys_created_by>Terry.Lillo</sys_created_by>
        <sys_created_on>2024-10-10 20:58:11</sys_created_on>
        <sys_id>a27655ebfb01de50e070fff26eefdc51</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_updated_by>Terry.Lillo</sys_updated_by>
        <sys_updated_on>2024-10-10 20:58:11</sys_updated_on>
    </sys_claim>
</record_update>
